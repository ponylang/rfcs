- Feature Name: fmt
- Start Date: 2016-07-05
- RFC PR: (leave this empty)
- Pony Issue: (leave this empty)

# Summary

This RFC proposes a single primitive for String formatting that acts separately from the objects being formatted. The format string can optionally contain embedded format specifications conforming to the syntax described below.

# Motivation

This change is motivated by the unnecessary complexity of the current formatting system in Pony.

Examples from the standard library followed by the new formatting:

[json/print.pony](https://github.com/ponylang/ponyc/blob/2b844f00aa9d8deb8cdd60031b78c01825ca76c3/packages/json/print.pony#L59)
```pony
let fmt = FormatSettingsInt.set_format(FormatHexBare).set_width(4)
out.append("\\u")
out.append(high.string(fmt))
out.append("\\u")
out.append(low.string(fmt))
```
```pony
Fmt("\\u{:4X}\\u{:4X}", [high, low])
```

[json/doc.pony](https://github.com/ponylang/ponyc/blob/2b844f00aa9d8deb8cdd60031b78c01825ca76c3/packages/json/doc.pony#L313)
```pony
let fmt = FormatSettingsInt.set_format(FormatHexBare).set_width(4)

if (value >= 0xDC00) or (trailing < 0xDC00) or (trailing >= 0xE000) then
  _error("Expected UTF-16 surrogate pair, got \\u" + value.string(fmt) +
    " \\u" + trailing.string(fmt))
  error
end
```
```pony
if (value >= 0xDC00) or (trailing < 0xDC00) or (trailing >= 0xE000) then
  _error(Fmt("Expected UTF-16 surrogate pair, got \\u{:4X}\\u{:4X}", [value.string(), trailing.string()]))
  error
end
```

# Detailed design

The syntax for the formatting language is similar to those of other languages, namely Python and Rust. The arguments are surrounded by `{}` rather that the common '%' which allows for allows for re-arranging the order of display without changing the arguments.

The grammar for the syntax is as follows:
```
fmt := '{' [arg] [':' spec] '}'
arg := USize
spec := [[fill]align] [sign] [alt] [width] [prec] [type]
fill := U8
align := ('<' | '^' | '>')
sign := ('+' | '-' | ' ')
alt := '#'
width := USize
prec := '.' USize
type := ('b' | 'd' | 'f' | 'o' | 'x' | 'X')
```

The `{` and `}` characters can be escaped by doubling, i.e. `{{` becomes `{` and `}}` becomes `}`.

The Fmt primitive:
```pony
primitive Fmt
  fun apply(fmt: String box, args: (ReadSeq[(String | Number)] | None) = None): String iso^ =>
```

Example use:
```pony
Fmt("Hello")
// "Hello"

Fmt("{{Hello}}")
// "{Hello}"

Fmt("Hello, {}!", ["world"])
// "Hello, world!"

Fmt("{}, {}, {0}, {}", ["0", "1", "2"])
// "0, 1, 0, 2"

Fmt("{:<10}", ["left"])
// "left      "

Fmt("{:>10}", ["right"])
// "     right"

Fmt("{:^10}", ["center"])
// "  center  "

Fmt("{0:d} {0:x} {0:X} {0:o} {0:b}", [USize(42)])
// "42 2a 2A 52 101010"

Fmt("{0:#x} {0:#o} {0:#b}", [USize(42)])
// "0x2a 0o52 0b101010"

Fmt("{:.2}", [F64(1.234567)])
// "1.23"

Fmt("{:+f}, {:+f}", [F64(3.14), F64(-3.14)])
// "+3.1400, -3.1400"

Fmt("{: f}, {: f}", [F64(3.14), F64(-3.14)])
// " 3.1400, -3.1400"

Fmt("{:-f}, {:-f}", [F64(3.14), F64(-3.14)])
// "3.1400, -3.1400"
```

Proof of concept can be found at [https://github.com/Theodus/pony-fmt](https://github.com/Theodus/pony-fmt)

# How We Teach This

There should be a section of the Pony Tutorial to explain the use of the formatting language in detail.

# Drawbacks

It would beak existing code if the current formatting primitives are removed.

# Alternatives

Keep the current formatting primitives.

# Unresolved questions

None.
